---

title: 【嵌入式开发 - 调试】01.BQ28Z610 电量计学习

date: 2021-09-10 09:37:14

tags:

  嵌入式开发 - 调试

categories: 嵌入式开发 - 调试

---

# BQ28Z610 电量计循环学习

## 一、chem-id 匹配

### 1、chem-id 匹配方式—数据采集

数据采集是记录常温下电池“`充满—静置—放空—静置`”过程中电压、电流、温度等三个变量随时间变化的数据，数据采集步骤如下：

- 将电池连接到电路板，电量计 PACK 端连接到电源负载正极、GND 连接到电源负载负极，使用 EV2400 调试器将电量计 SCL、SDA 连接到 PC；
- 开启 bqStudio 的 Log 功能；
- 对电池充电，充电截止电流要小于 0.01C；
- 静置 2 小时；
- 对电池以 0.1C 恒流放电（电流 = 0.1 * （容量 / h），如 8000mAh 的电池，放电电流为 800mA），放电至电芯的放电截止电压（3.7V锂电池截至电压一般为 3.0V）；
- 静置 5 小时。

记录时间间隔要小于 10s，bqStudio 开启 Log 后自动以 4s 的时间间隔进行刷新数据。

### 2、chem-id 匹配方式—数据处理

数据采集完成后，需要按照指定格式将数据打包上传到 TI GPCCHEM 网络计算工具，[https://www.ti.com/powercalculator/docs/gpc/gpcUpload.tsp](https://www.ti.com/powercalculator/docs/gpc/gpcUpload.tsp) 。

- 将生成的 log 文件重命名为 `roomtemp_rel_dis_rel.csv` ；

- 删除 csv 表中 `ElapsedTime, Voltage, Current, Temperature` 之外的数据列；

- 在生成的 csv 文件目录下创建 `config.txt` ，内容为：

  ```c
  ProcessingType=2         // 值必须是 2
  NumCellSeries=1          // 表示有几节电池串联
  ElapsedTimeColumn=0      // csv 表中时间所在的列号
  VoltageColumn=2          // csv 表中电压所在的列号
  CurrentColumn=3          // csv 表中电流所在的列号
  TemperatureColumn=1      // csv 表中温度所在的列号
  ```

- 将 config.txt 和 roomtemp_rel_dis_rel.csv 压缩打包为 zip 格式；

- 通过网站 [https://www.ti.com/powercalculator/docs/gpc/gpcUpload.tsp](https://www.ti.com/powercalculator/docs/gpc/gpcUpload.tsp) 将压缩包上传到 TI，之后邮箱中会收到 ID 匹配结果。

---

## 二、参数配置及校准

在电量计循环学习前需要先进行电量计参数配置及数据校准。

### 1、参数配置

1. 配置电池容量、电压、充电截止电压、放电截止电压等；
2. 可导入相似项目的 srec 文件（如 SC 更换电池，可使用以前的电量计固件），导入后要检查阻抗跟踪是否已经学习完成（ra flag、qmax等置位，Update Status 值为 0x06），需要把 `cycle count` 置为 1 ，`Update Status` 置为 0x00 或 0x02，把 `Cell0 R_a flag, Cell1 R_a flag, xCell0 R_a flag, xCell1 R_a flag` 的值都改为 ff55（或 ffff），表示阻抗表没有更新过。

**所有寄存器内容均通过 bqStudio 的 Data Memory 页面查看或写入**

![Untitled](https://img-typora-hikyuu.oss-cn-shanghai.aliyuncs.com/img/bq28z610-data-memory.png)

### 2、数据校准

数据校准内容主要包括电压、电流、温度，通过 bqStudio 的 Calibration 页面进行配置。

![Untitled](https://img-typora-hikyuu.oss-cn-shanghai.aliyuncs.com/img/bq28z610-calibration.png)

**所有参数配置完成后，发送 `0x41`（RESET）复位，并导出 gg 文件。**

![Untitled](https://img-typora-hikyuu.oss-cn-shanghai.aliyuncs.com/img/bq28z610-export.png)

---

## 三、电量计自学习

1. 断开电池对外输出供电；
2. 将电池电量放空并静置 5 小时，保证电池电压不会再发生变化（3.0v — 3.3v）；
3. 在 bqStudio 中向电量计发送 `0x21`（GAUGE_EN）使能电量计阻抗跟踪功能，通过 Read All 读取寄存器和标志位，此时 `Update Status` 的值应为 0x04（如果状态值不为 0x04，重新写 `Update Status` 为 0x00 或 0x02，重复0x41，0x21发送过程）；
4. 对电池进行常规充电（电池后期使用时的充电方式）并静置 2 小时；
5. 读取寄存器和标志位，如果更新成功 `Update Status = 0x05` 。如果`Update Status = 0x04` ，可以再静置 1 小时，如果还未更新需将电池电量放空后重复上述过程；
6. 以 0.1C~0.2C 的速度将电池放空，静置 5 小时。如果此步更新成功，`Update Status = 0x06`，否则重复上述充放电过程一遍；
7. 重复充电、放电操作，直至`Update Status = 0x0e` ，电量计学习完成； 
8. 导出 gg 文件和 srec 量产文件。

**注：`充电 — 静置 — 放电 — 静置` 操作共需要完成三个循环，第一个循环结束标志`Update Status = 0x05` 、第二个循环结束标志`Update Status = 0x06` 、第三个循环结束标志`Update Status = 0x0e` 。**

---

## 四、参考文档

- [https://www.ti.com/cn/lit/an/zhca955/zhca955.pdf](https://www.ti.com/cn/lit/an/zhca955/zhca955.pdf)
- [https://blog.csdn.net/zwb_578209160/category_9473475.html](https://blog.csdn.net/zwb_578209160/category_9473475.html)
- [https://e2echina.ti.com/support/power-management/f/power-management-forum/46539/faq-ti](https://e2echina.ti.com/support/power-management/f/power-management-forum/46539/faq-ti)
- [https://www.ti.com/lit/an/slua405/slua405.pdf?ts=1637315625962&ref_url=https%3A%2F%2Fcn.bing.com%2F](https://www.ti.com/lit/an/slua405/slua405.pdf?ts=1637315625962&ref_url=https%253A%252F%252Fcn.bing.com%252F)
- [https://www.ti.com/lit/an/slua875/slua875.pdf?ts=1637316300713&ref_url=https%3A%2F%2Fcn.bing.com%2F](https://www.ti.com/lit/an/slua875/slua875.pdf?ts=1637316300713&ref_url=https%253A%252F%252Fcn.bing.com%252F)
- [https://e2echina.ti.com/support/power-management/f/power-management-forum/135313/bq28z610](
